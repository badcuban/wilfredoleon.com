---
import BaseLayout from "../layouts/BaseLayout.astro";
import content from "../data/content";

// Exact Rubik's cube hover colors
const hexColors = [
  "#B90000", // UE Red
  "#0045AD", // Cobalt Blue
  "#FF5900", // Pantone Orange
  "#009B48", // Pigment Green
  "#FFD500", // Cyber Yellow
  "#FFFFFF"  // White
];
---

<BaseLayout
  title="Wilfredo Leon — Developer & Entrepreneur"
  description="Wilfredo Leon — Developer and entrepreneur building real products at the intersection of code and domain expertise. Creator of FACP Manuals and more."
  bodyClass="bg-zinc-950 text-zinc-300 font-sans selection:bg-zinc-800 selection:text-white min-h-screen"
>
  <!-- Background Grid Pattern -->
  <div class="fixed inset-0 z-[-1] opacity-5 pointer-events-none" style="background-image: linear-gradient(#ffffff 1px, transparent 1px), linear-gradient(90deg, #ffffff 1px, transparent 1px); background-size: 40px 40px;"></div>

  <nav class="fixed top-0 left-0 right-0 z-50 bg-zinc-950/80 backdrop-blur-md border-b border-zinc-800/50 transform-gpu">
    <div class="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
      <a href="#hero" class="flex items-center gap-3 group cursor-pointer no-underline">
        <!-- Mini 3x3 Grid Logo -->
        <div class="grid grid-cols-3 gap-0.5 w-6 h-6" id="header-logo-grid">
          {Array.from({ length: 9 }).map((_, i) => (
            <div 
              class={`w-full h-full rounded-[2px] ${i === 4 ? 'bg-white' : 'bg-zinc-800 group-hover:bg-[var(--c)]'} transition-colors duration-300 logo-dot-${i}`}
              style={i !== 4 ? `--c: ${hexColors[i % 6]}` : ''}
            ></div>
          ))}
        </div>
        <span class="font-bold tracking-widest text-sm uppercase text-white">{content.shortName}</span>
      </a>
      <div class="hidden md:flex gap-8 text-xs font-bold tracking-widest uppercase">
        {
          [
            { name: "About", color: "bg-[#0045AD]" }, // Blue
            { name: "Projects", color: "bg-[#FFD500]" }, // Yellow
            { name: "Now", color: "bg-[#009B48]" }, // Green
            { name: "Contact", color: "bg-[#FF5900]" } // Orange
          ].map((item) => (
            <a
              href={`#${item.name.toLowerCase()}`}
              class="flex items-center gap-2 group text-zinc-400 hover:text-white transition-colors"
            >
              <span class={`w-2 h-2 rounded-[2px] opacity-0 group-hover:opacity-100 transition-opacity ${item.color}`}></span>
              {item.name}
            </a>
          ))
        }
      </div>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-6 pt-32 pb-32">
    
    <!-- Hero -->
    <section id="hero" class="flex flex-row items-center justify-between gap-4 md:gap-12 pt-8 md:pt-16 mb-24 md:mb-32 scroll-mt-32 relative">
      <div class="flex-1 relative z-10 w-full text-left">
        <h1 class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black tracking-tighter text-white mb-4 md:mb-6 uppercase leading-[0.9]">
          {content.name.split(' ')[0]}<br />{content.name.split(' ')[1]}
        </h1>
        <p class="text-lg sm:text-xl md:text-2xl max-w-[180px] sm:max-w-[240px] md:max-w-xl font-light text-zinc-400 border-l-2 border-[#B90000] pl-4 md:pl-6 py-1 md:py-2 text-left leading-relaxed">
          {content.tagline}
        </p>
      </div>
      
      <!-- Three.js Canvas Container -->
      <div id="cube-canvas-container" class="absolute right-0 top-1/2 -translate-y-1/2 w-[220px] h-[220px] sm:w-[280px] sm:h-[280px] md:relative md:top-0 md:translate-y-0 md:w-[400px] md:h-[400px] flex-shrink-0 z-0 opacity-40 md:opacity-100 pointer-events-none md:pointer-events-auto"></div>
    </section>

    <div class="space-y-32">
      <!-- Section: About -->
      <section id="about" class="group scroll-mt-32 max-w-3xl">
        <div class="flex items-center gap-4 mb-8">
          <div class="w-8 h-8 grid grid-cols-2 gap-1">
            <div class="bg-[#0045AD] rounded-[2px]"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
          </div>
          <h2 class="text-sm font-bold tracking-widest uppercase text-white">About</h2>
        </div>
        <p class="text-sm sm:text-base md:text-xl leading-relaxed text-zinc-400 font-light pl-6 md:pl-12 border-l border-zinc-800/50">
          {content.about}
        </p>
      </section>

      <!-- Section: Projects -->
      <section id="projects" class="scroll-mt-32">
        <div class="flex items-center gap-4 mb-12 group">
          <div class="w-8 h-8 grid grid-cols-2 gap-1">
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-[#FFD500] rounded-[2px]"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
          </div>
          <h2 class="text-sm font-bold tracking-widest uppercase text-white">Projects</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 pl-0 md:pl-12">
          {content.projects.map((project, i) => (
            <div class="relative pl-8 border-l border-zinc-800/50 hover:border-zinc-600 transition-colors group">
              <!-- Status Indicator Cube -->
              <div class={`absolute -left-[5px] top-2 w-2 h-2 rounded-[2px] ${
                project.themeColor === "rubiks-red" ? "bg-[var(--color-rubiks-red)]" : 
                project.themeColor === "rubiks-yellow" ? "bg-[var(--color-rubiks-yellow)]" : 
                project.themeColor === "rubiks-green" ? "bg-[var(--color-rubiks-green)]" : 
                "bg-zinc-500"
              } shadow-[0_0_10px_rgba(255,255,255,0.1)] group-hover:shadow-[0_0_15px_currentColor] transition-shadow`}></div>
              
              <h3 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                {project.link && project.link !== "#" ? (
                  <a 
                    href={project.link} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="hover:opacity-80 transition-opacity flex items-center gap-2"
                  >
                    {project.title}
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-zinc-500">
                      <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                  </a>
                ) : (
                  project.title
                )}
              </h3>
              <p class="text-sm sm:text-base md:text-lg text-zinc-400 mb-8 font-light leading-relaxed">
                {project.description}
              </p>
              
              <div class="flex flex-wrap gap-2">
                {project.tags.map((tag) => (
                  <span class="text-xs px-3 py-1.5 bg-zinc-900 border border-zinc-800 rounded-md text-zinc-500">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- Section: Now -->
      <section id="now" class="group scroll-mt-32 max-w-3xl">
        <div class="flex items-center gap-4 mb-8">
          <div class="w-8 h-8 grid grid-cols-2 gap-1">
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-[#009B48] rounded-[2px]"></div>
          </div>
          <h2 class="text-sm font-bold tracking-widest uppercase text-white">Now</h2>
        </div>
        <p class="text-sm sm:text-base md:text-xl leading-relaxed text-zinc-400 font-light pl-6 md:pl-12 border-l border-zinc-800/50">
          {content.now}
        </p>
      </section>

      <!-- Section: Contact -->
      <section id="contact" class="group scroll-mt-32">
        <div class="flex items-center gap-4 mb-8">
          <div class="w-8 h-8 grid grid-cols-2 gap-1">
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
            <div class="bg-[#FF5900] rounded-[2px]"></div>
            <div class="bg-zinc-800 rounded-[2px] group-hover:bg-white transition-colors"></div>
          </div>
          <h2 class="text-sm font-bold tracking-widest uppercase text-white">Contact</h2>
        </div>
        <div class="flex flex-wrap gap-8 pl-6 md:pl-12 border-l border-zinc-800/50 py-2">
          {content.contact.map((link) => (
            <a
              href={link.url}
              target={link.icon === "email" ? undefined : "_blank"}
              rel={link.icon === "email" ? undefined : "noopener noreferrer"}
              class="text-zinc-400 hover:text-white transition-colors flex items-center gap-3 text-lg"
            >
              <span class="w-2 h-2 bg-zinc-700 rounded-sm"></span>
              {link.label}
            </a>
          ))}
        </div>
      </section>
    </div>
  </main>

  <!-- Mobile Bottom Nav -->
  <nav class="md:hidden fixed bottom-0 left-0 right-0 z-50 bg-zinc-950/90 backdrop-blur-md border-t border-zinc-800/50 transform-gpu" style="padding-bottom: env(safe-area-inset-bottom, 0px);">
    <div class="flex items-center justify-around px-4 py-4 text-[10px] font-bold tracking-widest uppercase">
      {
        [
          { name: "About", color: "bg-[#0045AD]" }, // Blue
          { name: "Projects", color: "bg-[#FFD500]" }, // Yellow
          { name: "Now", color: "bg-[#009B48]" }, // Green
          { name: "Contact", color: "bg-[#FF5900]" } // Orange
        ].map((item) => (
          <a
            href={`#${item.name.toLowerCase()}`}
            class="flex flex-col items-center gap-1.5 text-zinc-400 hover:text-white transition-colors"
          >
            <span class={`w-2 h-2 rounded-[2px] ${item.color}`}></span>
            {item.name}
          </a>
        ))
      }
    </div>
  </nav>

  <style>
    /* CSS for Interactive Logo Animation */
    .play-anim > div:not(.bg-white) {
      background-color: var(--c) !important;
    }

    .play-anim .logo-dot-0 { animation: moveDot0 4s ease-in-out; }
    .play-anim .logo-dot-1 { animation: moveDot1 4s ease-in-out; }
    .play-anim .logo-dot-2 { animation: moveDot2 4s ease-in-out; }
    .play-anim .logo-dot-3 { animation: moveDot3 4s ease-in-out; }
    .play-anim .logo-dot-5 { animation: moveDot5 4s ease-in-out; }
    .play-anim .logo-dot-6 { animation: moveDot6 4s ease-in-out; }
    .play-anim .logo-dot-7 { animation: moveDot7 4s ease-in-out; }
    .play-anim .logo-dot-8 { animation: moveDot8 4s ease-in-out; }

    @keyframes moveDot0 {
      0% { transform: translate(0, 0); opacity: 1; }
      10% { transform: translate(0, -100%); opacity: 0; }
      11% { transform: translate(0, 100%); opacity: 0; }
      20%, 25% { transform: translate(0, 0); opacity: 1; }
      
      35% { transform: translate(-100%, 0); opacity: 0; }
      36% { transform: translate(100%, 0); opacity: 0; }
      45%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot1 {
      0%, 25% { transform: translate(0, 0); opacity: 1; }
      35% { transform: translate(-100%, 0); opacity: 0; }
      36% { transform: translate(100%, 0); opacity: 0; }
      45%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot2 {
      0%, 25% { transform: translate(0, 0); opacity: 1; }
      35% { transform: translate(-100%, 0); opacity: 0; }
      36% { transform: translate(100%, 0); opacity: 0; }
      45%, 50% { transform: translate(0, 0); opacity: 1; }
      
      60% { transform: translate(0, 100%); opacity: 0; }
      61% { transform: translate(0, -100%); opacity: 0; }
      70%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot3 {
      0% { transform: translate(0, 0); opacity: 1; }
      10% { transform: translate(0, -100%); opacity: 0; }
      11% { transform: translate(0, 100%); opacity: 0; }
      20%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot5 {
      0%, 50% { transform: translate(0, 0); opacity: 1; }
      60% { transform: translate(0, 100%); opacity: 0; }
      61% { transform: translate(0, -100%); opacity: 0; }
      70%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot6 {
      0% { transform: translate(0, 0); opacity: 1; }
      10% { transform: translate(0, -100%); opacity: 0; }
      11% { transform: translate(0, 100%); opacity: 0; }
      20%, 75% { transform: translate(0, 0); opacity: 1; }
      
      85% { transform: translate(-100%, 0); opacity: 0; }
      86% { transform: translate(100%, 0); opacity: 0; }
      95%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot7 {
      0%, 75% { transform: translate(0, 0); opacity: 1; }
      85% { transform: translate(-100%, 0); opacity: 0; }
      86% { transform: translate(100%, 0); opacity: 0; }
      95%, 100% { transform: translate(0, 0); opacity: 1; }
    }

    @keyframes moveDot8 {
      0%, 50% { transform: translate(0, 0); opacity: 1; }
      60% { transform: translate(0, 100%); opacity: 0; }
      61% { transform: translate(0, -100%); opacity: 0; }
      70%, 75% { transform: translate(0, 0); opacity: 1; }
      
      85% { transform: translate(-100%, 0); opacity: 0; }
      86% { transform: translate(100%, 0); opacity: 0; }
      95%, 100% { transform: translate(0, 0); opacity: 1; }
    }
  </style>

  <script>
    import * as THREE from 'three';

    const setupInteractiveLogo = () => {
      const logoGrid = document.getElementById('header-logo-grid');
      if (!logoGrid) return;
      
      const dots = Array.from({ length: 9 }).map((_, i) => document.querySelector(`.logo-dot-${i}`));
      let animCooldown = false;

      const triggerAnim = () => {
        if (animCooldown) return;
        animCooldown = true;
        logoGrid.classList.remove('play-anim');
        void logoGrid.offsetWidth;
        logoGrid.classList.add('play-anim');
        
        // Phase 1: Left col up
        setTimeout(() => {
          const c0 = dots[0].style.getPropertyValue('--c');
          const c3 = dots[3].style.getPropertyValue('--c');
          const c6 = dots[6].style.getPropertyValue('--c');
          dots[0].style.setProperty('--c', c3);
          dots[3].style.setProperty('--c', c6);
          dots[6].style.setProperty('--c', c0);
        }, 420); // 10.5% of 4000ms

        // Phase 2: Top row left
        setTimeout(() => {
          const c0 = dots[0].style.getPropertyValue('--c');
          const c1 = dots[1].style.getPropertyValue('--c');
          const c2 = dots[2].style.getPropertyValue('--c');
          dots[0].style.setProperty('--c', c1);
          dots[1].style.setProperty('--c', c2);
          dots[2].style.setProperty('--c', c0);
        }, 1420); // 35.5% of 4000ms

        // Phase 3: Right col down
        setTimeout(() => {
          const c2 = dots[2].style.getPropertyValue('--c');
          const c5 = dots[5].style.getPropertyValue('--c');
          const c8 = dots[8].style.getPropertyValue('--c');
          dots[2].style.setProperty('--c', c8);
          dots[5].style.setProperty('--c', c2);
          dots[8].style.setProperty('--c', c5);
        }, 2420); // 60.5% of 4000ms

        // Phase 4: Bottom row left
        setTimeout(() => {
          const c6 = dots[6].style.getPropertyValue('--c');
          const c7 = dots[7].style.getPropertyValue('--c');
          const c8 = dots[8].style.getPropertyValue('--c');
          dots[6].style.setProperty('--c', c7);
          dots[7].style.setProperty('--c', c8);
          dots[8].style.setProperty('--c', c6);
        }, 3420); // 85.5% of 4000ms

        setTimeout(() => { 
          animCooldown = false; 
          logoGrid.classList.remove('play-anim');
        }, 4000);
      };
      
      logoGrid.addEventListener('mouseenter', triggerAnim);
      logoGrid.addEventListener('touchstart', triggerAnim, { passive: true });

      if (window.matchMedia('(hover: none)').matches) {
        window.addEventListener('scroll', triggerAnim, { passive: true });
      }
    };

    function initCube() {
      const container = document.getElementById('cube-canvas-container');
      if (!container) return;

      // Scene setup
      const scene = new THREE.Scene();
      
      // Camera setup
      const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
      
      // Adjust camera distance based on screen size so it fits
      const updateCameraZ = () => {
        if (window.innerWidth < 768) {
          camera.position.z = 4.2; // Zoomed in a bit more for mobile so the bigger canvas makes the cube feel huge
        } else {
          camera.position.z = 5.5; // Standard desktop distance
        }
      };
      updateCameraZ();

      // Renderer setup
      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      container.appendChild(renderer.domElement);

      // Create a unified Rubik's cube
      const cubeGroup = new THREE.Group();
      
      // The black plastic core for each piece
      const plasticGeo = new THREE.BoxGeometry(0.95, 0.95, 0.95);
      const plasticMat = new THREE.MeshBasicMaterial({ 
        color: 0x000000, // Pure black plastic
        transparent: true,
        opacity: 0.95
      });
      
      // The stickers that go on the outside faces of the plastic
      // Slightly smaller than 0.95 to leave a black border
      const stickerGeo = new THREE.PlaneGeometry(0.82, 0.82);
      
      // Material for non-center pieces (dark minimalist look)
      const darkStickerMat = new THREE.MeshBasicMaterial({ 
        color: 0x18181b, // zinc-900
        transparent: true,
        opacity: 0.95
      });

      // Define the exact Rubik's cube face colors for the center pieces
      const colorMats = {
        top: new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.95 }),    // White
        bottom: new THREE.MeshBasicMaterial({ color: 0xffd500, transparent: true, opacity: 0.95 }), // Cyber Yellow
        front: new THREE.MeshBasicMaterial({ color: 0x009b48, transparent: true, opacity: 0.95 }),  // Pigment Green
        back: new THREE.MeshBasicMaterial({ color: 0x0045ad, transparent: true, opacity: 0.95 }),   // Cobalt Blue
        left: new THREE.MeshBasicMaterial({ color: 0xff5900, transparent: true, opacity: 0.95 }),   // Pantone Orange
        right: new THREE.MeshBasicMaterial({ color: 0xb90000, transparent: true, opacity: 0.95 })   // UE Red
      };

      // Build a 3x3x3 grid
      const spacing = 1.0;
      for (let x = -1; x <= 1; x++) {
        for (let y = -1; y <= 1; y++) {
          for (let z = -1; z <= 1; z++) {
            // Skip the very center core block
            if (x === 0 && y === 0 && z === 0) continue;

            // Create the black plastic base piece
            const piece = new THREE.Mesh(plasticGeo, plasticMat);
            piece.position.set(x * spacing, y * spacing, z * spacing);

            // Determine if this is a center piece (exactly two coordinates are 0)
            const isCenter = (Math.abs(x) + Math.abs(y) + Math.abs(z) === 1);

            // Helper function to add a sticker to a specific face
            const addSticker = (posX, posY, posZ, rotX, rotY, colorMat) => {
              // If it's a center piece, use the bright color. Otherwise, use the dark minimalist color.
              const mat = isCenter ? colorMat : darkStickerMat;
              const sticker = new THREE.Mesh(stickerGeo, mat);
              sticker.position.set(posX, posY, posZ);
              sticker.rotation.set(rotX, rotY, 0);
              piece.add(sticker);
            };

            const d = 0.476; // Slightly outside the 0.475 edge of the plastic box to prevent z-fighting
            const PI = Math.PI;

            // Only add stickers to the EXPOSED outer faces of the 3x3x3 cube
            if (x === 1)  addSticker(d, 0, 0, 0, PI/2, colorMats.right);
            if (x === -1) addSticker(-d, 0, 0, 0, -PI/2, colorMats.left);
            if (y === 1)  addSticker(0, d, 0, -PI/2, 0, colorMats.top);
            if (y === -1) addSticker(0, -d, 0, PI/2, 0, colorMats.bottom);
            if (z === 1)  addSticker(0, 0, d, 0, 0, colorMats.front);
            if (z === -1) addSticker(0, 0, -d, 0, PI, colorMats.back);

            cubeGroup.add(piece);
          }
        }
      }

      scene.add(cubeGroup);

      // Animation loop
      function animate() {
        requestAnimationFrame(animate);

        // Rotate the entire group
        cubeGroup.rotation.x += 0.001815;
        cubeGroup.rotation.y += 0.0027225;

        renderer.render(scene, camera);
      }

      animate();

      // Handle resize
      window.addEventListener('resize', () => {
        if (!container) return;
        updateCameraZ();
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });
    }

    // Initialize immediately (Astro module scripts are deferred, so DOM is already parsed)
    setupInteractiveLogo();
    initCube();
  </script>
</BaseLayout>
